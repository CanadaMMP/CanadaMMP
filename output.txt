
> canada-election-reform@1.0.0 test /home/brianboyko/source/CanadaMMP
> mocha --recursive --compilers js:babel-register



  candidateName()
    ✓ correctly does each candidate's name

  fpp.js
    nationalPopularVoteByParty()
      ✓ finds the correct totals for each party's popular vote totals (67ms)
    seatsByParty()
      ✓ finds the correct totals for each party's seat totals (40ms)
    findWinner()
      ✓ finds the correct winner in each election
    proportionOfSeatsByParty()
      ✓ finds the correct proportion of seats
    proportionOfPopularVoteParty()
      ✓ finds the correct proportion of seats
    fppData()
      ✓ finds all of the above
      ✓ has the right seatsByParty
      ✓ has the right proportionOfSeatsByParty
[{"party":"Liberal","familyName":"McDonald","middleName":"","firstName":"Ken","votes":23528},{"party":"Andrews","familyName":"Andrews","middleName":"","firstName":"Scott","votes":7501},{"party":"NDP-New Democratic Party","familyName":"Baldwin","middleName":"","firstName":"Jeannie","votes":6075},{"party":"Conservative","familyName":"Barnett","middleName":"","firstName":"Lorraine E.","votes":4670},{"party":"Green Party","familyName":"Byrne-Puumala","middleName":"","firstName":"Krista","votes":228},{"party":"Forces et Démocratie - Allier les forces de nos régions","familyName":"McCreath","middleName":"","firstName":"Jennifer","votes":84}]
      1) has the right proportionOfNationalPopularVoteByParty

  mmp.js - tools for MMP calculation
    beatThreshholdEh()
      ✓ correctly determines if a party has beat the threshhold
    partiesPastThreshhold()
      ✓ correctly finds the parties past thresshold
    mmpFindWastage()
      ✓ finds the amount of wastage in an MMP election for different threshholds
    mmpReassignWastage()
      ✓ reassigns the wastage proportionally to each party
    mmpAssignSeats()
      ✓ assigns seats proportionally
    mapSeatsByParty (from sample)
      ✓ correctly takes document records and assigns the correct seats
    mapSeatsByParty (from DB)
      ✓ correctly takes document records and assigns the correct seats

  voteManip.js
    manipulatePartyByPercent()
{ apple: 1050 }
{ banana: 2850 }
      ✓ adds or subtracts based on increase or decrease

  Database Tests
    connectToMongo()
      ✓ connects to the mongo database
    insertDocuments()
      ✓ should insert a document

  /utils/readJson.js
    getFileNames()
      ✓ should call fs.readdir with the correct directory name
    writeFile()
      ✓ should write JSON to a file
    parseCSV()
      ✓ should convert CSV to JSON
    stripQuotes()
      ✓ should strip out escaped quote literals from string
    formatPollingPlaceInfo
      ✓ should take a raw JSON object and extract the important elements
    getAllFiles()
      ✓ should get all the files in the ./data/byDistrict directory and process them (59ms)
      ✓ should have written the right data
    jsonToObject()
      ✓ parses JSON files into javascript objects
    jsonToObject()
      ✓ parses JSON files into javascript objects
    readJsons()
      ✓ parses an array of filenames of JSON documents into JS objects


  29 passing (385ms)
  1 failing

  1) fpp.js fppData() has the right proportionOfNationalPopularVoteByParty:

      AssertionError: expected [ Array(6) ] to deeply equal []
      + expected - actual

      -[
      -  {
      -    "familyName": "McDonald"
      -    "firstName": "Ken"
      -    "middleName": ""
      -    "party": "Liberal"
      -    "votes": 23528
      -  }
      -  {
      -    "familyName": "Andrews"
      -    "firstName": "Scott"
      -    "middleName": ""
      -    "party": "Andrews"
      -    "votes": 7501
      -  }
      -  {
      -    "familyName": "Baldwin"
      -    "firstName": "Jeannie"
      -    "middleName": ""
      -    "party": "NDP-New Democratic Party"
      -    "votes": 6075
      -  }
      -  {
      -    "familyName": "Barnett"
      -    "firstName": "Lorraine E."
      -    "middleName": ""
      -    "party": "Conservative"
      -    "votes": 4670
      -  }
      -  {
      -    "familyName": "Byrne-Puumala"
      -    "firstName": "Krista"
      -    "middleName": ""
      -    "party": "Green Party"
      -    "votes": 228
      -  }
      -  {
      -    "familyName": "McCreath"
      -    "firstName": "Jennifer"
      -    "middleName": ""
      -    "party": "Forces et Démocratie - Allier les forces de nos régions"
      -    "votes": 84
      -  }
      -]
      +[]
      
      at Context.<anonymous> (test/frontend/js/utilities/spec_fpp.js:199:51)



